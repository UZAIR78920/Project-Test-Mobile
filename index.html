<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Class Scheduler - Higher Education</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #4a6741 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .header h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1em;
            opacity: 0.9;
        }

        .main-content {
            padding: 20px;
        }

        .auth-section {
            text-align: center;
            margin-bottom: 30px;
        }

        .login-form {
            display: inline-block;
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            width: 100%;
            max-width: 400px;
        }

        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #333;
            font-size: 14px;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 6px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .dynamic-inputs {
            margin-top: 15px;
            padding: 15px;
            border: 1px solid #e1e5e9;
            border-radius: 8px;
            background: #fafafa;
        }

        .subject-item, .faculty-item {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
            align-items: end;
        }

        .faculty-item {
            grid-template-columns: 1fr 2fr;
        }

        .subject-item input, .subject-item select,
        .faculty-item input, .faculty-item textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        .faculty-item textarea {
            height: 60px;
            resize: vertical;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            transition: transform 0.2s, box-shadow 0.2s;
            width: 100%;
            margin: 5px 0;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        }

        .btn-danger {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
        }

        .btn-small {
            width: auto;
            padding: 8px 16px;
            font-size: 14px;
            margin: 0;
        }

        .tabs {
            display: flex;
            flex-wrap: wrap;
            margin-bottom: 20px;
            border-bottom: 2px solid #e1e5e9;
            overflow-x: auto;
        }

        .tab {
            padding: 12px 15px;
            cursor: pointer;
            background: #f8f9fa;
            margin-right: 5px;
            margin-bottom: 5px;
            border-radius: 8px 8px 0 0;
            font-weight: 600;
            transition: all 0.3s;
            white-space: nowrap;
            font-size: 14px;
            flex-shrink: 0;
        }

        .tab.active {
            background: #667eea;
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            border-left: 5px solid #667eea;
        }

        .card h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .timetable {
            overflow-x: auto;
            margin-top: 20px;
        }

        .timetable table {
            width: 100%;
            min-width: 700px;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .timetable th, .timetable td {
            padding: 8px;
            text-align: center;
            border: 1px solid #e1e5e9;
            font-size: 12px;
        }

        .timetable th {
            background: #667eea;
            color: white;
            font-weight: 600;
        }

        .timetable td {
            background: #f8f9fa;
        }

        .class-slot {
            background: #28a745;
            color: white;
            padding: 6px;
            border-radius: 4px;
            font-size: 10px;
            margin: 2px 0;
            line-height: 1.2;
        }

        .class-slot.practical {
            background: #fd7e14;
            color: white;
        }

        .optimization-results {
            background: #e8f5e8;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 5px solid #28a745;
        }

        .suggestions {
            background: #fff3cd;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 5px solid #ffc107;
        }

        .hidden {
            display: none;
        }

        .status-message {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            text-align: center;
            font-weight: 600;
            font-size: 14px;
        }

        .status-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .data-list {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .data-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #e1e5e9;
            font-size: 14px;
        }

        .data-item:last-child {
            border-bottom: none;
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .approved-timetable-section {
            margin-top: 20px;
            padding: 20px;
            background: #e8f5e8;
            border-radius: 10px;
            border-left: 5px solid #28a745;
        }

        .download-section {
            margin-top: 15px;
            text-align: center;
        }

        /* Mobile-specific styles */
        @media (max-width: 768px) {
            body {
                padding: 5px;
            }

            .container {
                border-radius: 10px;
            }

            .header {
                padding: 15px;
            }

            .header h1 {
                font-size: 1.8em;
            }

            .header p {
                font-size: 0.9em;
            }

            .main-content {
                padding: 15px;
            }

            .login-form {
                padding: 20px;
                max-width: none;
            }

            .tabs {
                flex-wrap: nowrap;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                margin-bottom: 15px;
                padding-bottom: 5px;
            }

            .tab {
                padding: 10px 12px;
                font-size: 13px;
                min-width: auto;
            }

            .card {
                padding: 15px;
                margin-bottom: 15px;
            }

            .card h3 {
                font-size: 1.1em;
                margin-bottom: 12px;
            }

            .form-group {
                margin-bottom: 15px;
            }

            .btn {
                padding: 14px 20px;
                font-size: 16px;
                margin: 8px 0;
            }

            .subject-item {
                grid-template-columns: 1fr;
                gap: 8px;
            }

            .faculty-item {
                grid-template-columns: 1fr;
                gap: 8px;
            }

            .timetable {
                margin-top: 15px;
            }

            .timetable table {
                min-width: 600px;
            }

            .timetable th, .timetable td {
                padding: 6px;
                font-size: 11px;
            }

            .class-slot {
                padding: 4px;
                font-size: 9px;
                margin: 1px 0;
            }

            .optimization-results, .suggestions {
                padding: 12px;
                margin: 12px 0;
            }

            .data-item {
                padding: 8px;
                font-size: 13px;
            }

            .status-message {
                padding: 12px;
                font-size: 13px;
            }
        }

        /* Tablet styles */
        @media (min-width: 769px) and (max-width: 1024px) {
            .grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 25px;
            }

            .header h1 {
                font-size: 2.2em;
            }

            .main-content {
                padding: 30px;
            }
        }

        /* Large desktop styles */
        @media (min-width: 1025px) {
            .grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 30px;
            }

            .header {
                padding: 30px;
            }

            .header h1 {
                font-size: 2.5em;
            }

            .main-content {
                padding: 40px;
            }

            .btn {
                width: auto;
                display: inline-block;
                margin-right: 10px;
            }
        }

        /* Touch-friendly improvements */
        @media (hover: none) and (pointer: coarse) {
            .btn {
                min-height: 44px;
                padding: 14px 20px;
            }

            .tab {
                min-height: 44px;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .form-group input, .form-group select, .form-group textarea {
                min-height: 44px;
            }
        }

        /* Scrollbar styling */
        .tabs::-webkit-scrollbar {
            height: 3px;
        }

        .tabs::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        .tabs::-webkit-scrollbar-thumb {
            background: #667eea;
            border-radius: 3px;
        }

        .timetable::-webkit-scrollbar {
            height: 6px;
        }

        .timetable::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        .timetable::-webkit-scrollbar-thumb {
            background: #667eea;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🎓 Smart Class Scheduler</h1>
            <p>Intelligent Timetable Generation for Higher Education Institutions</p>
        </div>

        <div class="main-content">
            <!-- Authentication Section -->
            <div id="auth-section" class="auth-section">
                <div class="login-form">
                    <h2>Administrative Access</h2>
                    <div class="form-group">
                        <label for="username">Username:</label>
                        <input type="text" id="username" placeholder="Enter username">
                    </div>
                    <div class="form-group">
                        <label for="password">Password:</label>
                        <input type="password" id="password" placeholder="Enter password">
                    </div>
                    <button class="btn" onclick="login()">Login</button>
                </div>
            </div>

            <!-- Main Dashboard (Hidden until login) -->
            <div id="dashboard" class="hidden">
                <div class="tabs">
                    <div class="tab active" onclick="showTab('data-input')">Data Input</div>
                    <div class="tab" onclick="showTab('schedule-generation')">Generate</div>
                    <div class="tab" onclick="showTab('view-timetables')">View Timetables</div>
                    <div class="tab" onclick="showTab('reports')">Reports</div>
                </div>

                <!-- Data Input Tab -->
                <div id="data-input" class="tab-content active">
                    <div class="grid">
                        <div class="card">
                            <h3>🏢 Infrastructure</h3>
                            <div class="form-group">
                                <label for="classrooms">Number of Classrooms:</label>
                                <input type="number" id="classrooms" min="1" max="50" value="10">
                            </div>
                            <div class="form-group">
                                <label for="laboratories">Number of Laboratories:</label>
                                <input type="number" id="laboratories" min="0" max="20" value="5">
                            </div>
                            <div class="form-group">
                                <label for="classroom-capacity">Average Classroom Capacity:</label>
                                <input type="number" id="classroom-capacity" min="20" max="200" value="60">
                            </div>
                        </div>

                        <div class="card">
                            <h3>👥 Student Information</h3>
                            <div class="form-group">
                                <label for="departments">Number of Departments:</label>
                                <input type="number" id="departments" min="1" max="20" value="5">
                            </div>
                            <div class="form-group">
                                <label for="batches">Number of Student Batches:</label>
                                <input type="number" id="batches" min="1" max="50" value="15">
                            </div>
                            <div class="form-group">
                                <label for="batch-size">Average Batch Size:</label>
                                <input type="number" id="batch-size" min="20" max="100" value="45">
                            </div>
                        </div>

                        <div class="card">
                            <h3>📚 Academic Structure</h3>
                            <div class="form-group">
                                <label for="max-classes-day">Max Classes per Day:</label>
                                <input type="number" id="max-classes-day" min="4" max="10" value="8">
                            </div>
                            <div class="form-group">
                                <label for="days-week">Working Days per Week:</label>
                                <select id="days-week">
                                    <option value="5">5 Days</option>
                                    <option value="6" selected>6 Days</option>
                                </select>
                            </div>
                        </div>

                        <div class="card">
                            <h3>👨‍🏫 Faculty Information</h3>
                            <div class="form-group">
                                <label for="faculty-count">Number of Faculty:</label>
                                <input type="number" id="faculty-count" min="1" max="100" value="5" onchange="generateFacultyInputs()">
                            </div>
                            <div class="form-group">
                                <label for="avg-leaves">Average Leaves per Month:</label>
                                <input type="number" id="avg-leaves" min="1" max="10" value="2">
                            </div>
                            <div class="form-group">
                                <label for="max-load">Max Teaching Hours per Day:</label>
                                <input type="number" id="max-load" min="4" max="8" value="6">
                            </div>
                            
                            <div id="faculty-inputs" class="dynamic-inputs hidden">
                                <h4>Faculty Details:</h4>
                                <div id="faculty-list"></div>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <h3>📋 Subject Details</h3>
                        <div class="form-group">
                            <label for="subjects-count">Number of Subjects:</label>
                            <input type="number" id="subjects-count" min="1" max="100" value="8" onchange="generateSubjectInputs()">
                        </div>
                        
                        <div id="subject-inputs" class="dynamic-inputs">
                            <h4>Subject Configuration:</h4>
                            <div id="subject-list"></div>
                        </div>
                    </div>

                    <button class="btn btn-secondary" onclick="saveData()">Save Configuration</button>
                </div>

                <!-- Schedule Generation Tab -->
                <div id="schedule-generation" class="tab-content">
                    <div class="card">
                        <h3>🚀 Generate Optimized Timetables</h3>
                        <p>Click below to generate multiple optimized timetable options based on your configuration.</p>
                        <br>
                        <button class="btn" onclick="generateSchedules()">Generate Timetables</button>
                        <div id="generation-status"></div>
                    </div>

                    <div id="optimization-results" class="hidden">
                        <div class="optimization-results">
                            <h3>✅ Optimization Results</h3>
                            <div id="optimization-metrics"></div>
                        </div>
                        
                        <div class="suggestions">
                            <h4>💡 Optimization Suggestions</h4>
                            <div id="suggestions-list"></div>
                        </div>
                    </div>
                </div>

                <!-- View Timetables Tab -->
                <div id="view-timetables" class="tab-content">
                    <div class="card">
                        <h3>📅 Generated Timetables</h3>
                        <div class="form-group">
                            <label for="timetable-select">Select Timetable Option:</label>
                            <select id="timetable-select">
                                <option value="">Select a timetable...</option>
                            </select>
                        </div>
                        <button class="btn" onclick="viewTimetable()">View Selected Timetable</button>
                        <button class="btn btn-secondary" onclick="approveTimetable()">Approve & Finalize</button>
                    </div>

                    <div id="timetable-display" class="timetable hidden"></div>
                </div>

                <!-- Reports Tab -->
                <div id="reports" class="tab-content">
                    <div class="grid">
                        <div class="card">
                            <h3>📊 Utilization Reports</h3>
                            <div id="utilization-stats"></div>
                        </div>
                        <div class="card">
                            <h3>👥 Faculty Workload</h3>
                            <div id="faculty-stats"></div>
                        </div>
                        <div class="card">
                            <h3>🏢 Room Allocation</h3>
                            <div id="room-stats"></div>
                        </div>
                    </div>

                    <div id="approved-timetable" class="approved-timetable-section hidden">
                        <h3>✅ Approved Timetable</h3>
                        <div id="approved-timetable-display"></div>
                        <div class="download-section">
                            <button class="btn btn-secondary" onclick="downloadTimetable()">📥 Download as Excel</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Sample data storage
        let scheduleData = {};
        let generatedTimetables = [];
        let currentUser = null;
        let approvedTimetable = null;
        let labAssignments = {}; // Track lab assignments for subjects

        // Authentication
        function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            if (username === 'admin' && password === 'admin123') {
                currentUser = username;
                document.getElementById('auth-section').classList.add('hidden');
                document.getElementById('dashboard').classList.remove('hidden');
                showStatus('Login successful!', 'success');
                generateSubjectInputs(); // Initialize subject inputs
                generateFacultyInputs(); // Initialize faculty inputs
            } else {
                showStatus('Invalid credentials. Try admin/admin123', 'error');
            }
        }

        // Generate subject input fields dynamically
        function generateSubjectInputs() {
            const count = parseInt(document.getElementById('subjects-count').value) || 0;
            const container = document.getElementById('subject-list');
            container.innerHTML = '';

            for (let i = 1; i <= count; i++) {
                const subjectDiv = document.createElement('div');
                subjectDiv.className = 'subject-item';
                subjectDiv.innerHTML = `
                    <input type="text" placeholder="Subject ${i} Name" id="subject-name-${i}" value="">
                    <select id="subject-type-${i}">
                        <option value="Theory">Theory</option>
                        <option value="Practical">Practical</option>
                    </select>
                    <input type="number" placeholder="Classes/Week" id="subject-classes-${i}" min="1" max="10" value="4">
                `;
                container.appendChild(subjectDiv);
            }

            // Set default values
            const defaultSubjects = ['Mathematics', 'Physics', 'Chemistry', 'Computer Science', 'English', 'History', 'Economics', 'Biology'];
            const defaultTypes = ['Theory', 'Practical', 'Theory', 'Practical', 'Theory', 'Theory', 'Practical', 'Theory'];
            
            for (let i = 1; i <= Math.min(count, defaultSubjects.length); i++) {
                document.getElementById(`subject-name-${i}`).value = defaultSubjects[i-1];
                document.getElementById(`subject-type-${i}`).value = defaultTypes[i-1];
            }
        }

        // Generate faculty input fields dynamically
        function generateFacultyInputs() {
            const count = parseInt(document.getElementById('faculty-count').value) || 0;
            const container = document.getElementById('faculty-list');
            const inputsDiv = document.getElementById('faculty-inputs');
            
            container.innerHTML = '';
            
            if (count > 0) {
                inputsDiv.classList.remove('hidden');
                
                for (let i = 1; i <= count; i++) {
                    const facultyDiv = document.createElement('div');
                    facultyDiv.className = 'faculty-item';
                    facultyDiv.innerHTML = `
                        <input type="text" placeholder="Faculty ${i} Name" id="faculty-name-${i}" value="">
                        <textarea placeholder="Subjects they can teach (comma separated)" id="faculty-subjects-${i}"></textarea>
                    `;
                    container.appendChild(facultyDiv);
                }

                // Set default values
                const defaultFaculty = ['Dr. Smith', 'Dr. Johnson', 'Dr. Williams', 'Dr. Brown', 'Dr. Davis'];
                const defaultSubjects = ['Mathematics, Physics', 'Chemistry, Biology', 'Computer Science, English', 'History, Economics', 'Physics, Chemistry'];
                
                for (let i = 1; i <= Math.min(count, defaultFaculty.length); i++) {
                    document.getElementById(`faculty-name-${i}`).value = defaultFaculty[i-1];
                    document.getElementById(`faculty-subjects-${i}`).value = defaultSubjects[i-1];
                }
            } else {
                inputsDiv.classList.add('hidden');
            }
        }

        // Tab management
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        // Save configuration data
        function saveData() {
            const subjectsCount = parseInt(document.getElementById('subjects-count').value) || 0;
            const facultyCount = parseInt(document.getElementById('faculty-count').value) || 0;

            // Collect subject data
            let subjects = [];
            for (let i = 1; i <= subjectsCount; i++) {
                const name = document.getElementById(`subject-name-${i}`)?.value.trim();
                const type = document.getElementById(`subject-type-${i}`)?.value;
                const classes = parseInt(document.getElementById(`subject-classes-${i}`)?.value) || 4;
                
                if (name) {
                    subjects.push({ name, type, classesPerWeek: classes });
                }
            }

            // Collect faculty data
            let faculty = [];
            for (let i = 1; i <= facultyCount; i++) {
                const name = document.getElementById(`faculty-name-${i}`)?.value.trim();
                const subjectsStr = document.getElementById(`faculty-subjects-${i}`)?.value.trim();
                
                if (name && subjectsStr) {
                    const canTeach = subjectsStr.split(',').map(s => s.trim()).filter(s => s);
                    faculty.push({ name, canTeach });
                }
            }

            scheduleData = {
                infrastructure: {
                    classrooms: parseInt(document.getElementById('classrooms').value),
                    laboratories: parseInt(document.getElementById('laboratories').value),
                    classroom_capacity: parseInt(document.getElementById('classroom-capacity').value)
                },
                students: {
                    departments: parseInt(document.getElementById('departments').value),
                    batches: parseInt(document.getElementById('batches').value),
                    batch_size: parseInt(document.getElementById('batch-size').value)
                },
                academic: {
                    max_classes_day: parseInt(document.getElementById('max-classes-day').value),
                    days_week: parseInt(document.getElementById('days-week').value)
                },
                subjects: subjects,
                faculty: {
                    count: facultyCount,
                    avg_leaves: parseInt(document.getElementById('avg-leaves').value),
                    max_load: parseInt(document.getElementById('max-load').value),
                    list: faculty
                }
            };

            window.scrollTo({
                top: 0,
                behavior: "smooth"
            });
            showStatus('Configuration saved successfully!', 'success');
        }

        // Generate optimized schedules
        function generateSchedules() {
            if (Object.keys(scheduleData).length === 0) {
                showStatus('Please save configuration data first!', 'error');
                return;
            }

            document.getElementById('generation-status').innerHTML = '<div class="status-message"><span class="loading-spinner"></span>Generating optimized timetables... This may take a few moments.</div>';
            
            setTimeout(() => {
                generateMockTimetables();
                showOptimizationResults();
                populateTimetableSelector();
                document.getElementById('generation-status').innerHTML = '<div class="status-message status-success">✅ Successfully generated 3 optimized timetable options!</div>';
            }, 3000);
        }

        // Generate mock timetables with improved logic
        function generateMockTimetables() {
            const subjects = scheduleData.subjects || [];
            const faculty = scheduleData.faculty.list || [];
            const timeSlots = ['9:00-10:00', '10:00-11:00', '11:15-12:15', '12:15-1:15', '2:15-3:15', '3:15-4:15'];
            const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];

            generatedTimetables = [];
            labAssignments = {}; // Reset lab assignments

            // Initialize lab assignments for practical subjects
            subjects.forEach(subject => {
                if (subject.type === 'Practical') {
                    labAssignments[subject.name] = Math.floor(Math.random() * scheduleData.infrastructure.laboratories) + 1;
                }
            });

            for (let option = 1; option <= 3; option++) {
                let timetable = {
                    id: option,
                    name: `Timetable Option ${option}`,
                    schedule: {},
                    metrics: {
                        classroom_utilization: Math.floor(Math.random() * 20) + 75,
                        faculty_load_balance: Math.floor(Math.random() * 15) + 80,
                        conflict_count: Math.floor(Math.random() * 3),
                        optimization_score: Math.floor(Math.random() * 10) + 85
                    }
                };

                // Initialize schedule structure
                days.forEach(day => {
                    timetable.schedule[day] = {};
                    timeSlots.forEach(slot => {
                        timetable.schedule[day][slot] = null;
                    });
                });

                // Track used time slots to prevent conflicts
                let usedSlots = new Set();

                // Schedule classes for each subject
                subjects.forEach(subject => {
                    let classesScheduled = 0;
                    let attempts = 0;
                    const maxAttempts = 50;

                    while (classesScheduled < subject.classesPerWeek && attempts < maxAttempts) {
                        const day = days[Math.floor(Math.random() * days.length)];
                        const slot = timeSlots[Math.floor(Math.random() * timeSlots.length)];
                        const slotKey = `${day}-${slot}`;

                        // Check if slot is available and no conflict with same subject
                        if (!timetable.schedule[day][slot] && !usedSlots.has(`${subject.name}-${day}-${slot}`)) {
                            // Find eligible faculty
                            const eligibleFaculty = faculty.filter(f => f.canTeach.includes(subject.name));
                            const selectedFaculty = eligibleFaculty.length > 0 
                                ? eligibleFaculty[Math.floor(Math.random() * eligibleFaculty.length)]
                                : { name: 'Dr. Default' };

                            // Assign room based on subject type
                            let room = '';
                            if (subject.type === 'Practical') {
                                room = `Lab ${labAssignments[subject.name]}`;
                            } else {
                                room = `Room ${Math.floor(Math.random() * scheduleData.infrastructure.classrooms) + 1}`;
                            }

                            const batch = `Batch ${Math.floor(Math.random() * scheduleData.students.batches) + 1}`;

                            timetable.schedule[day][slot] = {
                                subject: subject.name,
                                type: subject.type,
                                room: room,
                                batch: batch,
                                faculty: selectedFaculty.name
                            };

                            usedSlots.add(`${subject.name}-${day}-${slot}`);
                            classesScheduled++;
                        }
                        attempts++;
                    }
                });

                generatedTimetables.push(timetable);
            }
        }

        // Show optimization results
        function showOptimizationResults() {
            const bestOption = generatedTimetables.reduce((best, current) => 
                current.metrics.optimization_score > best.metrics.optimization_score ? current : best
            );
            
            document.getElementById('optimization-metrics').innerHTML = `
                <p><strong>Best Option:</strong> ${bestOption.name}</p>
                <p><strong>Classroom Utilization:</strong> ${bestOption.metrics.classroom_utilization}%</p>
                <p><strong>Faculty Load Balance:</strong> ${bestOption.metrics.faculty_load_balance}%</p>
                <p><strong>Conflicts Resolved:</strong> ${bestOption.metrics.conflict_count} remaining</p>
                <p><strong>Overall Score:</strong> ${bestOption.metrics.optimization_score}/100</p>
            `;
            
            const suggestions = [
                "Lab assignments are consistent for practical subjects",
                "No simultaneous classes for same subjects detected", 
                "Faculty workload is well-balanced across all options",
                "Break timings are well-coordinated"
            ];
            
            document.getElementById('suggestions-list').innerHTML = suggestions.map(s => `<p>• ${s}</p>`).join('');
            document.getElementById('optimization-results').classList.remove('hidden');
        }

        // Populate timetable selector
        function populateTimetableSelector() {
            const selector = document.getElementById('timetable-select');
            selector.innerHTML = '<option value="">Select a timetable...</option>';
            
            generatedTimetables.forEach(tt => {
                const option = document.createElement('option');
                option.value = tt.id;
                option.textContent = `${tt.name} (Score: ${tt.metrics.optimization_score}/100)`;
                selector.appendChild(option);
            });
        }

        // View selected timetable
        function viewTimetable() {
            const selectedId = parseInt(document.getElementById('timetable-select').value);
            if (!selectedId) {
                showStatus('Please select a timetable option first!', 'error');
                return;
            }
            
            const timetable = generatedTimetables.find(tt => tt.id === selectedId);
            displayTimetable(timetable, 'timetable-display');
        }

        // Display timetable
        function displayTimetable(timetable, containerId) {
            const timeSlots = ['9:00-10:00', '10:00-11:00', '11:15-12:15', '12:15-1:15', '2:15-3:15', '3:15-4:15'];
            const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
            
            let html = `
                <h3>${timetable.name}</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Time</th>
                            ${days.map(day => `<th>${day}</th>`).join('')}
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            timeSlots.forEach(slot => {
                html += `<tr><td><strong>${slot}</strong></td>`;
                days.forEach(day => {
                    const classInfo = timetable.schedule[day][slot];

                    if (classInfo) {
                        const classTypeClass = classInfo.type === 'Practical' ? 'practical' : '';

                        html += `<td>
                            <div class="class-slot ${classTypeClass}">
                                <strong>${classInfo.subject}</strong><br>
                                ${classInfo.room}<br>
                                ${classInfo.batch}<br>
                                <small>${classInfo.faculty}</small>
                            </div>
                        </td>`;
                    } else {
                        html += '<td>-</td>';
                    }
                });
                html += '</tr>';
            });
            
            html += '</tbody></table>';
            
            document.getElementById(containerId).innerHTML = html;
            document.getElementById(containerId).classList.remove('hidden');
        }

        // Approve timetable
        function approveTimetable() {
            const selectedId = parseInt(document.getElementById('timetable-select').value);
            if (!selectedId) {
                showStatus('Please select a timetable option first!', 'error');
                return;
            }
            
            approvedTimetable = generatedTimetables.find(tt => tt.id === selectedId);
            showStatus('Timetable approved and finalized successfully!', 'success');
            generateReports();
            showApprovedTimetable();
        }

        // Show approved timetable in reports
        function showApprovedTimetable() {
            if (approvedTimetable) {
                const approvedSection = document.getElementById('approved-timetable');
                approvedSection.classList.remove('hidden');
                displayTimetable(approvedTimetable, 'approved-timetable-display');
            }
        }

        // Generate reports
        function generateReports() {
            // Utilization stats
            document.getElementById('utilization-stats').innerHTML = `
                <div class="data-list">
                    <div class="data-item"><span>Classroom Utilization</span><span>87%</span></div>
                    <div class="data-item"><span>Laboratory Utilization</span><span>73%</span></div>
                    <div class="data-item"><span>Peak Hours Efficiency</span><span>92%</span></div>
                    <div class="data-item"><span>Off-Peak Utilization</span><span>45%</span></div>
                </div>
            `;
            
            // Faculty stats
            const facultyList = scheduleData.faculty?.list || [];
            let facultyStatsHtml = '<div class="data-list">';
            
            if (facultyList.length > 0) {
                facultyList.forEach((faculty, index) => {
                    const hours = (4 + Math.random() * 3).toFixed(1);
                    facultyStatsHtml += `<div class="data-item"><span>${faculty.name}</span><span>${hours} hrs/day</span></div>`;
                });
            } else {
                facultyStatsHtml += `
                    <div class="data-item"><span>Average Teaching Hours</span><span>5.2/day</span></div>
                    <div class="data-item"><span>Workload Distribution</span><span>Balanced</span></div>
                    <div class="data-item"><span>Faculty Satisfaction</span><span>89%</span></div>
                `;
            }
            
            facultyStatsHtml += '</div>';
            document.getElementById('faculty-stats').innerHTML = facultyStatsHtml;
            
            // Room stats
            document.getElementById('room-stats').innerHTML = `
                <div class="data-list">
                    <div class="data-item"><span>Most Used Room</span><span>Room 5 (95%)</span></div>
                    <div class="data-item"><span>Least Used Room</span><span>Room 8 (67%)</span></div>
                    <div class="data-item"><span>Lab Utilization</span><span>Lab 1 (88%)</span></div>
                    <div class="data-item"><span>Capacity Optimization</span><span>93%</span></div>
                </div>
            `;
        }

        // Download timetable as Excel
        function downloadTimetable() {
            if (!approvedTimetable) {
                showStatus('No approved timetable to download!', 'error');
                return;
            }

            // Create CSV content
            const timeSlots = ['9:00-10:00', '10:00-11:00', '11:15-12:15', '12:15-1:15', '2:15-3:15', '3:15-4:15'];
            const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
            
            let csvContent = 'Time,' + days.join(',') + '\n';
            
            timeSlots.forEach(slot => {
                let row = slot;
                days.forEach(day => {
                    const classInfo = approvedTimetable.schedule[day][slot];
                    if (classInfo) {
                        row += ',"' + classInfo.subject + ' - ' + classInfo.room + ' - ' + classInfo.batch + ' - ' + classInfo.faculty + '"';
                    } else {
                        row += ',"Free"';
                    }
                });
                csvContent += row + '\n';
            });
            
            // Create and download file
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            
            if (link.download !== undefined) {
                const url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                link.setAttribute('download', `${approvedTimetable.name.replace(/\s+/g, '_')}.csv`);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                showStatus('Timetable downloaded successfully!', 'success');
            }
        }

        // Utility function to show status messages
        function showStatus(message, type) {
            const existingStatus = document.querySelector('.status-message');
            if (existingStatus) {
                existingStatus.remove();
            }
            
            const statusDiv = document.createElement('div');
            statusDiv.className = `status-message status-${type}`;
            statusDiv.textContent = message;
            
            const activeTab = document.querySelector('.tab-content.active');
            activeTab.insertBefore(statusDiv, activeTab.firstChild);
            
            setTimeout(() => {
                statusDiv.remove();
            }, 5000);
        }

        // Initialize
        window.onload = function() {
            console.log('Smart Class Scheduler initialized');
        };
    </script>
</body>
</html>
